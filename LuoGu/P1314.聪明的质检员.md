# P1314 [NOIP2011 提高组] 聪明的质监员

[P1314 NOIP2011 提高组 聪明的质监员 - 洛谷  计算机科学教育新生态](https://www.luogu.com.cn/problem/P1314)
## 题目描述

`小T` 是一名质量监督员，最近负责检验一批矿产的质量。这批矿产共有 $n$ 个矿石，从 $1$ 到 $n$ 逐一编号，每个矿石都有自己的重量 $w_i$ 以及价值 $v_i$ 。检验矿产的流程是：

1 、给定$m$ 个区间 $[l_i,r_i]$；

2 、选出一个参数 $W$；

3 、对于一个区间 $[l_i,r_i]$，计算矿石在这个区间上的检验值 $y_i$：

$$y_i=\sum\limits_{j=l_i}^{r_i}[w_j \ge W] \times \sum\limits_{j=l_i}^{r_i}[w_j \ge W]v_j$$  

其中 $j$ 为矿石编号。

这批矿产的检验结果 $y$ 为各个区间的检验值之和。即：$\sum\limits_{i=1}^m y_i$  

若这批矿产的检验结果与所给标准值 $s$ 相差太多，就需要再去检验另一批矿产。`小T` 不想费时间去检验另一批矿产，所以他想通过调整参数 $W$ 的值，让检验结果尽可能的靠近标准值 $s$，即使得 $|s-y|$ 最小。请你帮忙求出这个最小值。

## 输入格式

第一行包含三个整数 $n,m,s$，分别表示矿石的个数、区间的个数和标准值。

接下来的 $n$ 行，每行两个整数，中间用空格隔开，第 $i+1$ 行表示 $i$ 号矿石的重量 $w_i$ 和价值 $v_i$。

接下来的 $m$ 行，表示区间，每行两个整数，中间用空格隔开，第 $i+n+1$ 行表示区间 $[l_i,r_i]$ 的两个端点 $l_i$ 和 $r_i$。注意：不同区间可能重合或相互重叠。

## 输出格式

一个整数，表示所求的最小值。

## 样例 #1

### 样例输入 #1

```
5 3 15 
1 5 
2 5 
3 5 
4 5 
5 5 
1 5 
2 4 
3 3
```

### 样例输出 #1

```
10
```

## 提示

【输入输出样例说明】

当 $W$ 选 $4$ 的时候，三个区间上检验值分别为 $20,5 ,0$ ，这批矿产的检验结果为 $25$，此时与标准值 $S$ 相差最小为 $10$。

【数据范围】

对于 $10\%$ 的数据，有 $1 ≤n ,m≤10$；

对于 $30\%$的数据，有 $1 ≤n ,m≤500$ ；

对于 $50\%$ 的数据，有 $1 ≤n ,m≤5,000$；
 
对于 $70\%$ 的数据，有 $1 ≤n ,m≤10,000$ ；

对于 $100\%$ 的数据，有 $1 ≤n ,m≤200,000$，$0 < w_i,v_i≤10^6$，$0 < s≤10^{12}$，$1 ≤l_i ≤r_i ≤n$ 。

## 题解
**标签：前缀和、二分**

* 从极端角度考虑入手，当参数$W$小于所有矿石质量的最小值时，所有的矿石均会被选上，因此$y=\sum\limits_{i=1}^m y_i$的值会远大于$s$；当参数$W$大于所有矿石质量的最大值时，所有的矿石均不会被选上，因此$y=\sum\limits_{i=1}^m y_i$的值会远小于$s$。基于此，我们可以得到二分的条件：
    * 当$y>s$时，需要增大$W$来减小$y$，从而$∣y−s∣$变小；
    * 当$y=s$时，$∣y−s∣=0$；
    * 当$y<s$时，需要减小$W$来增大$y$，从而$∣y−s∣$变大；
  
* 值得注意的是，这个二分在$y=s$并不连续，因此我们需要手动记录距离$y=s$最近的上侧最小值和下侧最大值，并将两者作比较才能得到实际上最小的$∣y−s∣$。

* 使用前缀和可以优化此问题的求解时间复杂度，这也是此处题干中公式$y_i=\sum\limits_{j=l_i}^{r_i}[w_j \ge W] \times \sum\limits_{j=l_i}^{r_i}[w_j \ge W]v_j$看似如此复杂的原因，其这种形式某种程度上在提示我们要使用前缀和数组，但本题的前缀和数组累加受到$W$值的影响，应在二分判断的过程中进行处理，而不是输入时即进行预处理。
  
* 值得注意的是，$\left[ {case} \right]$表示case为真的时候取1，而case不为真的时候取0，因此$\sum\limits_{i = 1}^k {\left[ {cas{e_i}} \right]}$表示从$case_1$到$case_k$中$case_i$为真个数累加值，$\sum\limits_{i = 1}^k {\left[ {cas{e_i}} \right]nu{m_i}}$表示从$case_1$到$case_k$中$case_i$为真时对应$num_i$的累加值。
